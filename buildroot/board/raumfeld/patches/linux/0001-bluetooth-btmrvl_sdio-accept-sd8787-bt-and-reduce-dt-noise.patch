From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Buildroot Local <noreply@example.com>
Date: Fri, 19 Dec 2025 00:00:00 +0000
Subject: [PATCH] bluetooth: btmrvl_sdio: accept sd8787-bt, reduce DT noise, disable AMP

- Accept the DT compatible used by this board (marvell,sd8787-bt).
- Treat DT wake IRQ configuration as optional to avoid noisy boot logs.
- Disable SD8787 AMP device ID to avoid conflict with mwifiex on shared SDIO.

Signed-off-by: Buildroot Local <noreply@example.com>
---
 drivers/bluetooth/btmrvl_sdio.c | 15 +++++++++------
 1 file changed, 9 insertions(+), 6 deletions(-)

diff --git a/drivers/bluetooth/btmrvl_sdio.c b/drivers/bluetooth/btmrvl_sdio.c
index 000000000000..000000000000 100644
--- a/drivers/bluetooth/btmrvl_sdio.c
+++ b/drivers/bluetooth/btmrvl_sdio.c
@@ -41,8 +41,9 @@ static struct memory_type_mapping mem_type_mapping_tbl[] = {
 };
 
 static const struct of_device_id btmrvl_sdio_of_match_table[] __maybe_unused = {
+{ .compatible = "marvell,sd8787-bt" },
 { .compatible = "marvell,sd8897-bt" },
 { .compatible = "marvell,sd8997-bt" },
 { }
 };
@@ -72,10 +73,15 @@ static int btmrvl_sdio_probe_of(struct device *dev,
 struct btmrvl_plt_wake_cfg *cfg;
 int ret;
 
 if (!dev->of_node ||
     !of_match_node(btmrvl_sdio_of_match_table, dev->of_node)) {
-dev_info(dev, "sdio device tree data not available\n");
-return -1;
+return -ENODEV;
 }
 
 card->plt_of_node = dev->of_node;
+
+/* DT is optional; only set up wake IRQ if interrupts are described. */
+if (!of_find_property(card->plt_of_node, "interrupts", NULL))
+return 0;
@@ -88,7 +94,6 @@ static int btmrvl_sdio_probe_of(struct device *dev,
 _bt = irq_of_parse_and_map(card->plt_of_node, 0);
 (!cfg->irq_bt) {
-dev_err(dev, "fail to parse irq_bt from device tree\n");
 _bt = -1;
 else {
 = devm_request_irq(dev, cfg->irq_bt,
@@ -305,9 +310,6 @@ static const struct sdio_device_id btmrvl_sdio_ids[] = {
 /* Marvell SD8787 Bluetooth device */
 { SDIO_DEVICE(SDIO_VENDOR_ID_MARVELL, SDIO_DEVICE_ID_MARVELL_8787_BT),
 = (unsigned long)&btmrvl_sdio_sd8787 },
-/* Marvell SD8787 Bluetooth AMP device */
-{ SDIO_DEVICE(SDIO_VENDOR_ID_MARVELL, SDIO_DEVICE_ID_MARVELL_8787_BT_AMP),
-.driver_data = (unsigned long)&btmrvl_sdio_sd8787 },
 /* Marvell SD8797 Bluetooth device */
 { SDIO_DEVICE(SDIO_VENDOR_ID_MARVELL, SDIO_DEVICE_ID_MARVELL_8797_BT),
 = (unsigned long)&btmrvl_sdio_sd8797 },
--
2.43.0
